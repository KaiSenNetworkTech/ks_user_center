<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunos.tv.appupgrade.dal.dao.UpgradeVersionPrepublishDAO">

	<!--应用升级预发表总数据量不大，一个应用升级产生预发记录5条以内，一周预计升级应用一到两个（预发是一个过渡状态，有效时间比较短）-->	
	<select id="getActiveAppPrepublish" resultType="UpgradeVersionPrepublishDo" parameterType="UpgradeVersionPrepublishDo">
		SELECT 
			`id`, `name`, `version_id`, `model_id`, `parent_id`, `barrier_count`, `is_active`
		FROM
			`upg_version_prepublish`
		WHERE
			<if test="versionIdList != null">
				`version_id` IN 
				<foreach item="item" index="index" collection="versionIdList" open="(" separator="," close=")">
					#{item}
				</foreach>
				AND 	
			</if>
			<if test="versionId != null">
				`version_id` = #{versionId} AND
			</if>
			<if test="modelIdList != null">
				`model_id` IN 
				<foreach item="item" index="index" collection="modelIdList" open="(" separator="," close=")">
					#{item}
				</foreach>
				AND 	
			</if>	
			<if test="modelId != null">
				`model_id` = #{modelId} AND
			</if>	
			is_delete = 0 AND
		  	is_active = 1 AND
		  	parent_id > 0 
		ORDER 
			BY `id` DESC	
		LIMIT 999
	</select>

</mapper>
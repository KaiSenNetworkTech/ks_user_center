<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunos.tv.appupgrade.dal.dao.PreUnInstallAppDAO">
	<!--获取-->	
	<select id="getListByCondition" resultType="PreUnInstallAppDo" parameterType="PreUnInstallAppDo">
		SELECT 
			`id`,`app_id`,`version_code`,`version`,`release_note`,`gmt_modify`
		FROM 
			`pre_uninstall_app` 
		WHERE 
			`app_id` = #{appId} AND
			`version_code` IN (0, #{versionCode}) AND
			`is_delete` = 0  
		ORDER BY 
			`version_code` DESC
		LIMIT 100	
	</select>
	

	<!--有效需要卸载应用列表（数据量比较少）-->	
	<select id="getPreUnInstallAppAllList" resultType="AppDo">
		SELECT a.id
		FROM
			`app` a
		LEFT JOIN 
			`pre_uninstall_app` p
		ON 
			a.id = p.app_id
		LEFT JOIN
			pre_app_device d
		ON
			d.pre_app_id = p.id
		WHERE
			p.is_delete = 0 AND
			d.is_delete = 0 AND
			a.is_delete = 0 AND
			d.pre_type = 1 AND	
			d.status IN (1,2,4)
	</select>			

		
	<!--获取-->	
	<select id="getListByAppId" resultType="PreUnInstallAppDo" parameterType="long">
		SELECT 
			`id`,`app_id`,`version_code`,`version`,`release_note`,`gmt_modify`
		FROM 
			`pre_uninstall_app` 
		WHERE 
			`app_id` = #{appId} AND
			`is_delete` = 0  
		ORDER BY 
			`version_code` DESC
		LIMIT 100	
	</select>		

</mapper>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunos.tv.appupgrade.dal.dao.PreInstallAppDAO">

	<!--获取-->	
	<select id="getListByAppId" resultType="PreInstallAppDo" parameterType="long">
		SELECT 
			`id`,`app_id`,`version_code`,`version`,`allow_uninstall`,`release_note`,`original_url`,
			`download_path`,`download_md5`,`gmt_modify`,`size`
		FROM 
			`pre_install_app` 
		WHERE 
			`app_id` = #{appId} AND
			`is_delete` = 0  
		ORDER BY 
			`version_code` DESC
	</select>
	
	
	<!--获取全部有效状态的应用预装ID，同一时期数据量不大-->	
	<select id="getPreInstallAppAllList" resultType="AppDo">
		SELECT a.id
		FROM
			`app` a
		LEFT JOIN 
			`pre_install_app` p
		ON 
			a.id = p.app_id
		LEFT JOIN
			pre_app_device d
		ON
			d.pre_app_id = p.id
		WHERE
			p.is_delete = 0 AND
			d.is_delete = 0 AND
			a.is_delete = 0 AND
			d.pre_type = 0 AND	
			d.status IN (1,2,4)
	</select>
</mapper>